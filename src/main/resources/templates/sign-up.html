<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}">
<!--    <link rel="stylesheet" type="text/css" th:href="styles.css"/>-->

    <meta charset="UTF-8">
    <title>Postcode Test</title>

    <!--TODO extern zetten-->
    <style>
        /* Chrome, Safari, Edge, Opera */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Firefox */
        input[type=number] {
            -moz-appearance: textfield;
        }


        .signuppage .grid {
            display: grid;
            grid-gap: 10px 40px;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(1, 1fr);
        }

        .signuppage #mandatory {
            font-style: italic;
        }
    </style>

</head>
<body class="signuppage">

<div th:include="fragments/header :: header"></div>

<div class="container">
    <br>
    <h1>Aanmeldingspagina</h1>
    <br>
    <p id="mandatory">Velden met een * zijn verplicht</p>
    <br>
    <form method="POST" th:object="${customerBean}" th:action="@{customerCompleted}" onSubmit="return pass();">
        <div class="grid">
            <div id="personalData">
                <div class="form-group">
                    <label for="surname">Achternaam*</label>
                    <input type="text" class="form-control" id="surname" name="surname" th:field="*{surname}" required>
                </div>
                <div class="form-group">
                    <label for="inserts">Tussenvoegsels</label>
                    <input type="text" class="form-control" id="inserts" name="inserts" th:field="*{inserts}">
                </div>
                <div class="form-group">
                    <label for="initials">Voorletters*</label>
                    <input type="text" class="form-control" id="initials" name="initials" th:field="*{initials}" required>
                </div>
                <div class="form-group">
                    <label for="socialSecurityNo">BSN-nummer*</label>
                    <input type="number" class="form-control" id="socialSecurityNo" name="socialSecurityNo" th:field="*{socialSecurityNo}" required>
                </div>
            </div>

            <div id="addressData">
                <div class="form-group">
                    <label for="zipcode">Postcode*</label>
                    <input type="text" class="form-control" id="zipcode" name="zipcode" th:field="*{zipCode}" onkeyup="retrieve_address('zipcode',this.value)" required>
                </div>
                <div class="form-group">
                    <label for="housenumber">Huisnummer*</label>
                    <input type="number" class="form-control" id="housenumber" name="housenumber" th:field="*{houseNumber}" onkeyup="retrieve_address('housenumber', this.value)" required>
                </div>
                <div class="form-group">
                    <label for="affix">Toevoeging</label>
                    <input type="text" class="form-control" id="affix" name="affix" th:field="*{affixes}" onkeyup="retrieve_address('affix', this.value)">
                </div>
                <div class="form-group">
                    <label for="affix">Straat</label>
                    <input type="text" class="form-control" id="street" name="street" th:field="*{street}" readonly required>
                </div>
                <div class="form-group">
                    <label for="city">Plaats</label>
                    <input type="text" class="form-control" id="city" name="city" th:field="*{city}" readonly required>
                </div>
            </div>

            <div id="userData">
                <div class="form-group">
                    <label for="username">Gebruikersnaam*</label>
                    <input type="text" class="form-control" id="username" name="username" th:field="*{username}" required>
                </div>
                <div class="form-group">
                    <label for="password">Wachtwoord*</label>
                    <input type="password" class="form-control" id="password" name="password" th:field="*{password}" required>
                </div>
                <div class="form-group">
                    <label for="password2">Herhaal wachtwoord*</label>
                    <input type="password" class="form-control" id="password2" name="password2" required>
                </div>
            </div>


            <div class="buttons">
                <input class="btn btn-outline-dark" type="submit" value="Bevestigen">
                <input class="btn btn-outline-dark" type="button" value="Annuleren" onclick="location.href='/'">
            </div>

        </div>
    </form>

    <br/>
    <br/>
    <br/>

</div>

<script>
    // Code for retrieving ZIP information from bwnr.nl API
    // Declare empty variables
    var zipcode = "";
    var housenumber= "";
    var affix = "";

    function retrieve_address(id, value) {
        console.log("Methode wordt aangeroepen")
        // Load form data into variables
        // Return if no valid input (yet)
        if (id == "zipcode") {
            var zip = value.trim();
            console.log(zip);
            // Check for minimum of 6 characters
            if (zip.length < 6) {
                return;
            }
            // Check for numeric value of >1000
            var zip_numeric = zip.substr(0, 4);
            if (parseFloat(zip_numeric) < 1000) {
                return;
            }
            // Check if last 2 characters are alphabetical
            var zip_alpha = zip.substr(-2);
            if (zip_alpha.charCodeAt(0) < 65 || zip_alpha.charCodeAt(0) > 122 || zip_alpha.charCodeAt(1) < 65 || zip_alpha.charCodeAt(1) > 122) {
                return;
            }
            // Concatenate final zipcode
            zipcode = zip_numeric + zip_alpha.toUpperCase();
            document.getElementById("zipcode").value = zipcode;
        }
        if (id == "housenumber") {
            // Check if housenumber is not empty and >0
            housenumber = parseFloat(value);
            if (!housenumber || housenumber == 0) {
                return;
            }
            document.getElementById("housenumber").value = housenumber;
        }
        if (id == "affix") {
            affix = value.trim();
            document.getElementById("affix").value = affix;
        }
        if (!housenumber) {
            return;
        }

        // Create API url
        var apiRequest = "https://bwnr.nl/postcode.php?pc=" + zipcode + "&hn=" + housenumber + "&tv=" + affix + "&tg=data";
        var xmlHttpRequest = new XMLHttpRequest();

        // Catch responses
        xmlHttpRequest.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var rString = this.responseText;
                if (rString == "Geen resultaat.") {
                    return;
                }
                if (rString == "Input onvolledig.") {
                    return;
                }
                if (rString == "Onbekende API Key.") {
                    return;
                }
                if (rString == "Over quota") {
                    return;
                }

                // Autofill responses
                var aResponse = rString.split(";");
                document.getElementById("street").value = aResponse[0];
                document.getElementById("city").value = aResponse[1];
            }
        }

        // Execute API request
        xmlHttpRequest.open("GET", apiRequest, true);
        xmlHttpRequest.send();
    }

        function pass() {
            var password = document.getElementById("password").value
            var password2 = document.getElementById("password2").value
            if (password != password2) {
                alert("Wachtwoorden komen niet overeen, probeer opnieuw");
                return false;
            }
            return true;


    }


</script>







</body>
</html>